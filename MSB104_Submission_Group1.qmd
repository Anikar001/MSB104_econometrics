---
title: "Regional Inequalities and economic growth; cross section and times series analysis"
author: "Anine Therese Karlsen & Mona Lisa Jones"
format: pdf
abstract: "This assignment aims to acquire, process, and analyze sub-national GDP and population data for a subset of European countries. Firstly (assignment 1), Calculateing GDP per capita and exploreing regional inequity using various descriptive statistics and visualizations.Secondly (assignment 2), examining the relationship between regional development and inequality, employing cross sectional estimation techniques for the year 2010.Lastly exploring alternative functional forms and implementing panel estimation to analzise the relationship between regional development inequality"
editor: visual
bibliography: [Regional_inequality_23.bib, econometrics.bib]
page-layout: full
number-sections: true
papersize: a4
csl: apa.csl
---

```{r}
#| label: setup
#| output: false
#| echo: false

library(tidyverse)
library(tinytex)
library(dplyr)
library(ggplot2)
library(readxl)
library(magrittr)
library(vtable)
library(lubridate)
library(dineq)
library(huxtable)
library(plm)
library(sandwich)
library(lmtest)
```

# Introduction

While national GDP and GDP per capita are vital indicators of a country's aggregate economic health, they do not shed light on how wealth or income is distributed among its residents. A high national GDP can, paradoxically, coexist with pockets of regional deprivation [@lessmann2017].

The truth of this statement becomes more evident when taking a closer look at sub-national data. Regional wealth disparities are of prime concern, especially when crafting policies for equitable growth [@lessmann2017]. A country's macro-level prosperity does not automatically guarantee that all its regions partake equally in this wealth. By studying smaller regions within a country, it is possible to get a more nuanced narrative about the state of regional economic disparities [@lessmann2017].

Using time series data and cross-sectional observations we investigate Economic growth and Inequality trends in Portugal, France, Hungary, Slovenia and Denmark in the time period 2000 to 2020. The aims are to acquire, process, and analyse sub-national GDP, GINI and population data for a subset of European countries.

The primary objective is to gain knowledge of econometric methods used for science in business through our given topic. Subsequently, econometric terms and definitions are explained in greater detail than it normally would in similar papers. Using GDP per capita and the Gini coefficient. Moreover, both are vital indicators in the field of economics and are frequently used, in a wide array of studies. Furthermore, to analyse and interpret the economic conditions and social disparities of different regions or countries. Their analysis provides crucial insights for policymakers, economists, and researchers in shaping and evaluating the effectiveness of socio-economic policies.

The research question ***"What are the regional economic growth and inequality measurements from 2000 to 2020, in selected European countries and how does other*** ***determinants affect the results?"*** is key in guiding our study. Setting a solid foundation for a comprehensive study that not only measure our given parameters, but also a critically examination of the role of determinants such as transportation infrastructure and education. @lessmann2017 states that transportation costs play an important role in agglomeration and income, and reduced transportation costs as a determinant of regional inequality.

The sructure of our study is methodically designed to facilitate this exploration. In part 1A and B we calculate GDP per capita and explore regional inequality using various descriptive statistics and visualizations such as panel data (***Assignment_1***). In part 2A and B we use cross sectional method to examine the relationship between regional development and inequality, employing cross sectional estimation techniques for the year 2010 (***Assignment_2***). Furthermore, exploring alternative functional forms and implementing panel estimation to analzise the relationship between regional development inequality (***Assignment_3***).

Lastly, it is worth noting potential limitations may arise due to the use of ChatGPT and ChatGPT PDF, which have been utilized as tools to gain understanding and extract knowledge from academic papers, as well as to explain econometric terms and definitions. The text generated by these tools has been cross-checked to the best of our knowledge with our textbook and Andre Seidel, lecturer and author of 'Regional Inequality, Convergence, and Its Determinants -- A View from Outer Space' (2017). Despite these precautions, there may be instances where incorrect information was provided, and some errors could have been overlooked. The text has been meticulously rewritten to fit our style of writing, ensuring consistency and accuracy throughout our study.

# Literature Review: Regional Economic Growth, Inequality and determines (2000-2020)

Why some places grow and prosper is a fundamental question in social science research. This question motivated Adam Smith's work, *An Inquiry into the Nature and Causes of the Wealth of Nations,* (Smith [1863](https://link-springer-com.galanga.hvl.no/article/10.1007/s11187-014-9574-4#ref-CR32 "Smith, A. (1863). An inquiry into the nature and causes of the wealth of nations. Edinburgh: A. & C Black.")) and has been a major influence of the *new economic geography* [@feldman2014]*. Furthermore,* regional growth and inequality have been important topics of research in Europe for many years. In recent decades, the European Union implemented policies aimed at reducing regional disparities and promoting economic growth across its member states. Furthermore, despite these efforts, significant disparities in income and economic development persist across regions in Europe [@lessmann2017].

**Economic Growth and Regional Disparities**

Regional growth in Europe exhibits a complex pattern, influenced significantly by factors such as geography, human capital, and economic policies. Lessmann and Seidel's research offers insights into these dynamics, highlighting the persistence of income disparities, across regions despite overarching economic advancement [@lessmann2017]. Wealthier nations like Denmark tend to experience quicker regional convergence, a phenomenon supported by Gennaioli et al.'s findings [@gennaioli2014].

**Financial crisis, and EU membership for Slovakia and Hungary**

The 2008 financial crisis significantly disrupted regional growth and exacerbated income inequalities across Europe. Nguyen et al. highlight that financial turmoil typically leads to increased income disparity; a trend observed globally [@nguyen2022].

Focusing on Europe, we expect varied regional economic performances, especially when comparing Eastern European countries such as Hungary and Slovakia to their Western counterparts. Given the role of capital market regulations in promoting regional convergence, outlined by Gennaioli et al., we anticipate a potential growth acceleration. In particular for Eastern European countries following their EU accession in 2003 and 2004 [@gennaioli2014]. However, the financial crisis and subsequent labour market shifts may also have influenced these trends.

EU membership provided Slovakia and Hungary with resources for economic recovery, while Western European countries, including Denmark, Portugal, and France, likely experienced significant economic declines due to the financial crisis, a pattern possibly mirrored in the recent COVID-19 pandemic. In particular Portugal as the crisis hit them harder. These complexities highlight the importance of a detailed analysis to understand regional economic growth and inequality in challenging times.

**Regional inequality**

Another affect that surprised us was that the economic crisis led to increase inequality. The study "*the effects of financial crisis on regional inequality*" indicate any type of financial crisis results in higher income inequality [@nguyen2022].

@lessmann2017 regional inequality study address the importance of studying these aspects. Its potential consequences, such as political tensions that can undermine social and political stability [@lessmann2017]. The paper also discusses the relationship between regional inequality and personal income inequality and conflict risk.

**Determinants of regional inequality**

Geographic characteristics stand out as pivotal, with the natural and topographical elements of a region significantly swaying income distributions [@lessmann2017].

Urbanization emerges as a crucial determinant, where bustling, populous around urban centers usually enjoy elevated income levels, contrasting starkly with the often-stark disparities witnessed in more rural and secluded areas [@lessmann2017].

*Transport infrastructure and Education*

Transport infrastructure plays a central role in shaping regional economic landscapes. Improved connectivity fosters economic activities, reduces travel time, and enhances accessibility to markets and resources. Studies indicates that regions with robust transport infrastructure tend to attract more investments, generate employment, and ultimately contribute to regional prosperity.

[@lessmann2017] also discusses the determinant of Education in the context of human capital. The study mentions that human capital is the most important determinant of differences in regional development within countries. The study also notes that human capital creates positive externalizes, which can spill over regional boundaries. Moreover, the quality of human capital within countries, as measured by the secondary-school enrollment rate, can decrease regional inequality by facilitating regional spillovers and convergence. Lastly, promoting internal migration.

**Expected Inverted U- and N shaped curves**

Furthermore, @lessmann2017 provides us with insights into the inverted U-shaped relationship between regional inequality and the level of economic development in different country groups [@lessmann2017]. The inverted U-shape also referred to as Kuznets Curve suggests that as an economy develops, regional inequality initially rises, reaches a peak, and then starts to decline.

@lessmann2017 paper also finds that there is an N-shaped relationship between regional inequality and economic development, which means that regional inequality increases again after the inverted U-shaped pattern has been completed [@lessmann2017].

@iammarino2019 discusses regional inequalities in European countries. It presents evidence that inter-regional inequality has been increasing in the European Union since the turn of the millennium. The authors argue that this is due to the existence of several groups of regional economies in Europe that are structurally very different from one another [@iammarino2019]. Additionally, the authors argue that there are some countries in the EU that are more evenly developed than others, and that a map of under performance or over-performance means less in a high-income but evenly developed country, such as in Denmark in our case [@iammarino2019]. On the other hand, France has been a subject of discussion and policy making for many years, regarding its well-known pockets of extreme wealth in regions such as Cap d'Antibes.

Overall, it is evident that regional economic growth and inequality in Europe from 2000 to 2020 have been influenced by a constellation of factors, with transport infrastructure and education emerging as significant determinants. Earlier studies provide us with a fundamental understanding of these dynamics, while also highlighting the nuanced impacts of economic crises on regional disparities. The integration of transport infrastructure and education into this discourse adds an additional layer of complexity, underscoring its potential as a catalyst for regional development and equality.

# Data and Descriptive

## **Data collection**

All dataset used in this paper is from Eurostat and based on the Nomenclature of Territorial Units for Statistics (NUTS) classification. The NUTS system provides a hierarchical classification of the EU's economic territory, facilitating the collection and harmonization of European statistics, and ranges from the national level (NUTS 0) to smaller regional divisions (NUTS 3).

The collected data for GDP per capita includes values in current prices and those adjusted for purchasing power parity (PPP), enabling comparisons by accounting for price level differences. GDP at market prices measures the total economic output within regions, adjusted by taxes, subsidies, and not delineated by specific sectors.

Furthermore, population data includes annual figures on births, deaths, net migration, along with demographic details. Eurostat update these dataset annually. Furthermore, transportation infrastructure data encompasses the extent of the inland transport network, including motorways, railways, and waterways, within the EU, EFTA, and candidate countries. It is reported annually by various national authorities and used to explore the link between infrastructure and regional development. Educational attainment data reflects the highest level of education completed by individuals within regions, with additional metrics on employment and education status, particularly among young people. This data is derived from annual averages of the EU Labor Force Survey.

```{r}
#| echo: false
#| output: false

# This section of the code is dedicated to adding data to RStudio. We will import the datasets into the RStudio environment for further analysis, manipulation, and visualization using R.

# Data for population
pop_data <- read_csv("Raw_data/demo.gz")

# Data for GDP
gdp_data <- read_csv("Raw_data/nama.gz")
```

```{r}
#| echo: false
#| output: false
# Renaming and selecting the variables we want to keep
# We're doing this in order to make the datasets more clean and easy to read

gdp_data_01 <- gdp_data |>
  select(geo, year = TIME_PERIOD, GDP = OBS_VALUE)

pop_data_01 <- pop_data |>
  select(geo, year = TIME_PERIOD, population = OBS_VALUE)
```

In this section, we explore a variety of descriptive statistics, crucial for understanding regional income inequality, a concept that presents challenges due to the heterogeneity of regions. Our dataset encompasses a diverse range of regions, each varying significantly in size and population.

This paper focuses on two distinct types of measures: static and dynamic. Static measures offer a cross-sectional snapshot, providing a perspective on these inequalities at a specific point in time. In contrast, dynamic measures track historical trends, offering insights into how these disparities evolve over time, a concept well-articulated in [@wooldridge2020].

Moreover, to effectively convey our findings, we utilize graphical representations, particularly focusing on GDP per capita across various regions. These visualizations not only aid in understanding the current state of regional disparities but also in tracing their progression over time.

## Descriptive statistics

**Mean**

We calculate the mean to provide a representative value for the dataset, facilitating understanding of its central tendency and serving as a benchmark against which deviations and anomalies can be assessed, in later steps when building and interpreting regression models [@wooldridge2020].

**MMR**

Comparing the GRP per capita of the region with the highest income to the region with the lowest income (minimum GDP per capita) provides a measure of the range of these disparities. If this measure is small (close to 1), then it would mean that the different regions have relatively equal incomes [@wooldridge2020]. If this measure is large, then the interpretation is more problematic, as it does not tell if the high ratio is due to substantial variation in the distribution of per capita GDRPs or the presence of outliers. Nevertheless, maximum to minimum ratio (MMR) provides a quick, easy to comprehend, and politically powerful measure of regional income inequality.

**Standard diviation (SD)**

Calculating SD to quantify the dispersion or variability of a data set around its mean. Helping us assess the degree of uncertainty, variability, or risk associated with an economic variable or parameter, which is crucial for understanding the reliability of estimations and predictions [@wooldridge2020].

**Median**

The median serves as a robust measure of central tendency, especially when a dataset may have outliers or is skewed. Unlike the mean, the median is not influenced by extreme values and, thus, can provide a clearer picture of the "typical" value in situations where the data distribution is not symmetrical [@wooldridge2020].

## Part 1A: Sub-national GDP and GDP per Capita

### GDP per Capita Calculation

The formula for calculating GDP per Capita is as follows:

$y_i=GDP_i/population_i$

```{r}
#| echo: false
#| output: false

# Merging the datasets pop_data and gdp_data into one dataset by joining the variables "geo" and "year". 

merged_data <- left_join(pop_data_01, gdp_data_01, join_by(geo, year))

# Select Only NUTS 3 Regions
# Filter for specific countries, this will be useful when we will find the GDP per capita for the countries seperately

merged_data <- merged_data |>
  filter(
    startsWith(as.character(geo), "PT") | 
    startsWith(as.character(geo), "FR") | 
    startsWith(as.character(geo), "HU") |
    startsWith(as.character(geo), "SK") | 
    startsWith(as.character(geo), "DK")
  ) %>%
  
# Filter rows where 'geo' column has more than 4 characters to select only NUTS3 regions
  filter(nchar(as.character(geo)) > 4) %>%
  
# Rename 'geo' column to 'id_nuts3'
  rename(id_nuts3 = geo)
```

```{r}
#| echo: false
#| output: false

# Calculating GDP per Capita

GDP_per_capita <- merged_data |>
  mutate(
    GDP_per_capita = round(100*GDP/population, digits = 2)
  )

# we use *100 in order to get the gdp per capita as a percentage, and digits = 2 to limit it down to two decimals
```

When exploring our data we will look at different NUTS levels aswell as countries both together and seperated.

### GDP per capita Portugal

```{r}
#| echo: false
#| output: false

# Making a dataset that only contains data from Portugal
# Use the na.omit function in order to remove NA values, cant make ggplot with NA values. 

Portugal_data <- GDP_per_capita |>
  filter(grepl("PT", id_nuts3)) |>
  na.omit(Portugal_data)
```

```{r}
#| echo: false

# Making a figure using ggplot that shows us variations of GDP per capita across the different NUTS 3 regions in Portugal. 

Portugal_data_plot <- ggplot(Portugal_data, aes(x = year, y = GDP_per_capita, color = id_nuts3)) +
  geom_line() +
  labs(title="Figure 1: GDP per Capita for Portugal", 
       x="Year",
       y="GDP per Capita") +
  theme(legend.position="none")

# Print out the figure

print(Portugal_data_plot)
```

HER NÅ VI BESKRIVE TRENDER

```{r}
#| echo: false
#| output: false

# Calculate summary statistics for Portugal, chosing only GDP per capita 
summary_stats_portugal <- sapply(Portugal_data["GDP_per_capita"], function(x) c(
  mean = mean(x),
  median = median(x),
  std_dev = sd(x),
  minimum = min(x),
  maximum = max(x)
))

# Print the summary statistics #APPENDIX
print(summary_stats_portugal)
```

Portugal's regional GDP per capita is characterized by relatively consistent values across the country. The descriptive statistics of these values show a mean of approximately 1.42 and a median of 1.39. This close alignment between the mean and median suggests a balanced distribution of economic value across regions.

Furthermore, the standard deviation is 0.37, indicating a modest variation in GDP per capita across different regions. This is comparatively low when viewed against similar statistics from other countries, suggesting a more uniform economic landscape within Portugal.

Examining the range, the minimum GDP per capita is 0.65, and the maximum is 2.72. The narrow gap between these extremes further supports the observation of limited economic disparity across the regions. While urban areas like Lisbon have higher GDP per capita, indicative of economic concentration, the overall disparity across the country remains relatively low.

### GDP per capita France

```{r}
#| echo: false
#| output: false

# Making a dataset that only contains data from France

France_data <- GDP_per_capita |>
  filter(grepl("FR", id_nuts3)) |>
  na.omit(France_data)
```

```{r}
#| echo: false

# Making a figure using ggplot that shows us variations of GDP per capita across the different NUTS 3 regions in France. 

France_data_plot <- ggplot(France_data, aes(x = year, y = GDP_per_capita, color = id_nuts3)) +
  geom_line() +
  labs(title="Figure 1: GDP per Capita for France", 
       x="Year",
       y="GDP per Capita") +
  theme(legend.position="none")

print(France_data_plot)
```

```{r}
#| echo: false
#| output: false

# Calculate summary statistics for France, chosing only GDP per capita 
summary_stats_france <- sapply(France_data["GDP_per_capita"], function(x) c(
  mean = mean(x),
  median = median(x),
  std_dev = sd(x),
  minimum = min(x),
  maximum = max(x)
))

# Print the summary statistics
print(summary_stats_france)
```

GDP per capita statistics from France show that the mean is 2.63, indicating an overall high economic status across regions. The median, at 2.44, is lower than the mean, suggesting a distribution skewed towards wealthier areas. The standard deviation is 1.05, highlighting considerable regional economic variability. The range is notably wide, with the minimum GDP per capita at 0.83 and the maximum at 11.58, underscoring stark contrasts. Regions like Île-de-France, encompassing Paris, and affluent areas like the southern Riviera, likely contribute to the high maximum value, illustrating a significant economic divide between urban centres and rural areas.

### GDP per capita Hungary

```{r}
#| echo: false
#| output: false

# Making a dataset that only contains data from Hungary

Hungary_data <- GDP_per_capita |>
  filter(grepl("HU", id_nuts3)) |>
  na.omit(Hungary_data)
```

```{r}
#| echo: false

# Making a figure using ggplot that shows us variations of GDP per capita across the different NUTS 3 regions in Hungary. 

Hungary_data_plot <- ggplot(Hungary_data, aes(x = year, y = GDP_per_capita, color = id_nuts3)) +
  geom_line() +
  labs(title="Figure 1: GDP per Capita for Hungary", 
       x="Year",
       y="GDP per Capita") +
  theme(legend.position="none")

print(Hungary_data_plot)
```

HVA SKJER HER!

```{r}
#| echo: false
#| output: false

# Calculate summary statistics for Hungary, chosing only GDP per capita 
summary_stats_hungary <- sapply(Hungary_data["GDP_per_capita"], function(x) c(
  mean = mean(x),
  median = median(x),
  std_dev = sd(x),
  minimum = min(x),
  maximum = max(x)
))

# Print the summary statistics
print(summary_stats_hungary)
```

In Hungary, the GDP per capita data shows notable regional disparities. With a mean of 0.8598 and a median of 0.765, the higher mean suggests Budapest's significant economic influence. The standard deviation of 0.406 and the wide range from a minimum of 0.32 to a maximum of 3.13 further highlight Budapest's economic dominance compared to other regions.

### GDP per capita Slovakia

```{r}
#| echo: false
#| output: false

# Making a dataset that only contains data from Slovakia

Slovakia_data <- GDP_per_capita |>
  filter(grepl("SK", id_nuts3)) |>
  na.omit(Slovakia_data)
```

```{r}
#| echo: false

# Making a figure using ggplot that shows us variations of GDP per capita across the different NUTS 3 regions in Slovakia. 

Slovakia_data_plot <- ggplot(Slovakia_data, aes(x = year, y = GDP_per_capita, color = id_nuts3)) +
  geom_line() +
  labs(title="Figure 1: GDP per Capita for Slovakia", 
       x="Year",
       y="GDP per Capita") +
  theme(legend.position="none")

print(Slovakia_data_plot)
```

```{r}
#| echo: false
#| print: false

# Calculate summary statistics for Slovakia, chosing only GDP per capita 
summary_stats_slovakia <- sapply(Slovakia_data["GDP_per_capita"], function(x) c(
  mean = mean(x),
  median = median(x),
  std_dev = sd(x),
  minimum = min(x),
  maximum = max(x)
))

# Print the summary statistics
print(summary_stats_slovakia)
```

In Slovakia, the GDP per capita statistics reveals significant regional economic differences. The mean GDP per capita is 1.2502, higher than the median of 1.095, indicating that Bratislava, the capital and largest city, may substantially boost the national average due to its economic prominence.

The large standard deviation of 0.8018 and the extensive range from a minimum of 0.30 to a maximum of 4.02 highlighting urbanization in areas such as Bratislava's distinct economic status. These figures indicate that while most regions have moderate economic levels, Bratislava stand out with a much higher GDP per capita, with its role as the economic centre of Slovakia.

### GDP per capita Denmark

```{r}
#| echo: false
#| output: false

# Making a dataset that only contains data from Denmark

Denmark_data <- GDP_per_capita |>
  filter(grepl("DK", id_nuts3)) |>
  na.omit(Denmark_data)
```

```{r}
#| echo: false

# Making a figure using ggplot that shows us variations of GDP per capita across the different NUTS 3 regions in Denmark. 

Denmark_data_plot <- ggplot(Denmark_data, aes(x = year, y = GDP_per_capita, color = id_nuts3)) +
  geom_line() +
  labs(title="Figure 1: GDP per Capita for Denmark", 
       x="Year",
       y="GDP per Capita") +
  theme(legend.position="none")

print(Denmark_data_plot)
```

```{r}
#| echo: false
#| print: false

# Calculate summary statistics for Denmark, chosing only GDP per capita 
summary_stats_denmark <- sapply(Denmark_data["GDP_per_capita"], function(x) c(
  mean = mean(x),
  median = median(x),
  std_dev = sd(x),
  minimum = min(x),
  maximum = max(x)
))

# Print the summary statistics
print(summary_stats_denmark)
```

Lastly, In Denmark, with its higher mean of 4.4192 compared to the median of 4.0000 suggests regions like Copenhagen, with its significant economic activity, are likely elevating the national average. The standard deviation of 1.3439 indicates moderate regional economic disparities, while the range from 2.76 to 8.42 reflects Copenhagen's economic prominence relative to other regions.

## Part 1B: Regional Inequity

### Gini Coefficient Calculation

In this part we will compute the population-weighted GDP Gini coefficient for each European NUTS2 region in our assigned countries.

The gini coefficient can help us measure inequality in a distribution, as is therefore a useful tool for us to use when we look at regional inequity. The closer the gini coefficient is to 1, the bigger the inequality is; a number closer to 0 equals equality. When looking at the gini coefficient for NUTS 2 regions, we also get a better overview over differences in income between different regions, and it also makes it easier to find the reasons as to why there is a difference between the regions @hasell2023.

With the use of the NUTS3 GDP per capita data and this formula:

$GINW_j=\frac{1}{2 \bar{y_j}} \sum_{i}^{n_j}\sum_{l}^{n_j}\frac{p_i}{P_j} \frac{p_l}{P_j} |y_i-y_l|$

```{r}
#| echo: false
#| output: false

# Before we can find the Gini coefficient for NUTS2 regions, we have to generate NUTS 2 and 0 identifiers

# Generate NUTS 2 and 0 Identifiers
main_data <- GDP_per_capita |> 
  mutate(
    id_nuts2 = substr(id_nuts3, 1, 4),
    id_nuts0 = substr(id_nuts3, 1, 2)
  ) 
```

```{r}
#| echo: false
#| output: false

# Calculating gini
gini <- main_data |>
  filter(population != 0) |>
  filter(population != "NA") |>
  filter(GDP_per_capita != 0) |>
  filter(GDP_per_capita != "NA") |>
  group_by(id_nuts2, year) |>
  mutate(gini_n2 = gini.wtd(GDP_per_capita, weights = population)) |>
  ungroup()


# Slice function to remove numbers that get repeated. 
gini_nuts_2 <- gini |>
  group_by(id_nuts2, year) |>
  slice(1) |>
  ungroup()

# Since some NUTS 2 and 3 regions are the same (like Copenhagen for example), some gini coefficients will be 0. We should remove them before doing further analysis and data presentation

# Filter data
gini_filtered <- gini_nuts_2 |>
  filter(gini_n2 != 0)
```

After calculating the gini coefficients, we can see that there are some similarities to the data we got from GDP per capita for NUTS 3 regions. In order to see these similarities better, as well as look for other important aspects that can be provided trough the calculations, we will visualize the data in three different ways.

```{r}
#| echo: false

# Creating a bar chart
ggplot(gini_filtered, aes(x = id_nuts2, y = gini_n2, fill = id_nuts0)) +
  geom_bar(stat = "identity") +
  ggtitle("Gini Coefficient by NUTS 2 Region") +
  xlab("NUTS 2 Region ID") +
  ylab("Gini Coefficient") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

```{r}
#| echo: false

# Creating a time-series plot
ggplot(gini_filtered, aes(x = year, y = gini_n2, color = id_nuts2)) +
  geom_line() +
  ggtitle("Time-series Plot of Gini Coefficient by NUTS 2 Region") +
  xlab("Year") +
  ylab("Gini Coefficient")
```

```{r}
#| echo: false

# Creating a box plot
ggplot(gini_filtered, aes(x = id_nuts0, y = GDP_per_capita)) +
  geom_boxplot() +
  ggtitle("Distribution of GDP per Capita by Country") +
  xlab("Country") +
  ylab("GDP per Capita")
```

# Cross sectional estimates

## Part 2A: Growth and Inequity

### **Data acquisition**

Firstly, the data is summerised for the year 2010 at the NUTS2 regional level, focusing on economic metrics. Processing the dataset containing the NUTS3 level. Thereafter, computing the total GDP and total population for each NUTS2 region and year. Then, derive the GDP per capita at the NUTS2 level by dividing the total GDP by the total population again. Furthermore, narrowing down the dataset to observations from the year 2010 where the Gini coefficient is positive. Then adding, logarithmic transformations to linearize relationships or to reduce the impact of extreme values.

The next step is making a data frame of NUTS2 2010 and grouping by NUTS0 country level variables, as well as allocating NUTS2 to selected countries. Lastly presenting data in **table XXX** showing a count of NUTS2 regions within each top-level region or country in the 2010 data.

The next step is, estimating a Linear Regression for All Countries using cross sectional data from 2010, NUTS2.

### **Cross Sectional Analysis**

With cross-sectional data analysis we create a snapshot of the year 2010. Cross-sectional data is simpler to manage and interpret than time-series or panel data. With data from only one time point, we avoid complications arising from temporal dynamics. Cross-sectional data allows for the comparison of different regions at the same time, which can be crucial for identifying disparities or differences between the regions [@wooldridge2020].

### **Simple linear regression model**

In this part of the paper, we will carry out a simple regression model and explore the effect of regional economic development, represented by 𝑦𝑗 (GDP per capita), on regional inequality, represented by 𝐺𝐼𝑁 𝐼𝑊𝑗. We will do this to gain an understanding of the connection between economic growth indicators such as GDP per capita and inequality might have. We will explore if higher GDP per capita may lead to less or greater inequality, and gain an understanding to what extent these variables are related.

Unlike the traditional Gini coefficient, which treats all individuals equally regardless of the population size of the region they reside in, the weighted Gini considers the population size of each region, assigning more weight to regions with larger populations.

In the context of regional inequality, this is particularly important because it ensures that the income disparities in more populous regions have a proportionally larger impact on the overall measure of inequality. For instance, if a country has one region with a very high level of income per capita but a small population, and another region with a lower level of income per capita but a large population, the weighted Gini coefficient would reflect the inequality experienced by a larger portion of the country's population, providing a more accurate picture of the national income distribution.

We use simple linear regression to model the relationship with the GINI as the dependent variable and the natural logarithm of GDP per capita as the independent variable. Capturing the relationship between regional development and regional inequality for all regions in 2010.

**Model assumptions**

"The relationship between our dependent and independent variables is linear, ensuring a clear and direct connection between them. Each observation operates independently of the others, emphasizing the unique contribution of every data point. Additionally, we expect homoscedasticity, implying that the variance of the residuals remains consistent regardless of the independent variable's level. It's also crucial that, for any specified value of X, Y maintains a normal distribution. And although more pertinent to multiple regression, it's worth noting the absence of multicollinearity, ensuring that no two predictors are closely correlated."

**Model specification**

$$
Y_i = β_1 + β_2X_i + ε_i
$$

$Y_i$ represent the dependent/ explained variable

$X_i$ represent the independent/ explanatory variable

$β_1$ represent the intercept/ constant

$β_2$ represent the slope coefficient

$ε_i$ represents the residuals or error in the prediction.

**Intercept (**β0​): represents the value of Y when X is 0.

**Slope (**β1​): Indicates the change in Y for a one-unit change in X.

For our model we have:

$GINI = \beta_{0} + \beta_{1} \cdot \text{GDP per capita} + \epsilon$

#### **Goodness of fit**

The goodness of fit in a simple linear regression model measures how well the regression line approximates the real data points. The regression line that best represents the data according to the least squares criterion, which minimizes the sum of the squared vertical distances of the points from the line.

R\^2 is a statistical measure that represents the proportion of the variance for the dependent variable that's explained by the independent variable. It ranges from 0 to 1. A higher R\^2 value indicates a better fit of the model to the data.

R\^2 = 0 The model does not explain any of the variability of the response data around its mean.

R\^2 = 1 The model explains all the variability of the response data around its mean.

If the assumptions for a simple linear regression are met, it indicates a good fit for the model. [Plotting the data can provide a visual indication of the goodness of fit.]{.underline} The points should fall around a straight line without clear patterns in the residuals. As it is crucial to verify these assumptions before proceeding with interpreting the results of the regression analysis.

**Residuals vs. Fitted Values Plot** to check for homoscedasticity and linearity. Ideally, this plot shows no pattern; the residuals are randomly scattered around the horizontal line at zero. If there's a pattern (like a curve or systematic spread of residuals), it suggests non-linearity or heteroscedasticity.

**Normal Q-Q Plot** to check if the residuals are approximately normally distributed. The points should fall roughly along a straight line. Deviations from a straight line suggest deviations from normality.

```{r}
#| echo: false
#| output: false

# Making a dataframe that only contains observations from 2010, we're also filtering the data so that gini is bigger than 0. 

data2010 <- gini_nuts_2 |>
  filter(year == 2010, gini_n2 > 0)
```

```{r}
#| echo: false
#| fig-cap: Regression statistics of all countries for the year 2010

# Finding the natural logarithm of GDP per capita
data2010 <- data2010 |> 
  mutate(log_GDP_per_capita = log(GDP_per_capita))


# lm(y ~ x) y = gini, x = log of GDP per capita, estimation of linear regression model
lm <- lm(gini_n2 ~ log_GDP_per_capita, data = data2010)

# Save coefficients
b0_earn <- lm$coefficients[1]
b1_earn <- lm$coefficients[2]

# Regression statistics by using huxreg
huxreg(All = lm, 
       statistics = c("r.squared","adj.r.squared", "statistic", "p.value"))
```

```{r}
#| echo: false
#| fig-cap: Regression statistics of all countries seperately for the year 2010

# Estimation for each country seperately 
lmSK <- lm(gini_n2 ~ log_GDP_per_capita, subset(data2010, id_nuts0 == "SK"))
lmDK <- lm(gini_n2 ~ log_GDP_per_capita, subset(data2010, id_nuts0 == "DK"))
lmHU <- lm(gini_n2 ~ log_GDP_per_capita, subset(data2010, id_nuts0 == "HU"))
lmPT <- lm(gini_n2 ~ log_GDP_per_capita, subset(data2010, id_nuts0 == "PT"))
lmFR <- lm(gini_n2 ~ log_GDP_per_capita, subset(data2010, id_nuts0 == "FR"))

# Regression statistics
huxreg(SK = lmSK, 
       DK = lmDK, 
       HU = lmHU, 
       PT = lmPT, 
       FR = lmFR, 
       statistics = c("r.squared","adj.r.squared", "statistic", "p.value"))
```

**Model Diagnostics**

We'll now look at some of the numbers we got from the linear regression model (for all countries combined):

-   Coefficients:

    -   Intercept is 0.0551 (expected value of gini when GDP per capita is 0). Statistically significant (indicated by p-value).

    -   Estimated coefficient for GDP per capita is 0.0193, if the natural logarithm of GDP per capita increase by one, then the gini coefficient will increase by 0.0193. The p-value associated with the coefficent is however not statistically significant at 5% level.

-   Goodnes of fit:

    -   Multiple R-squared (0.08028) indicate that around 8% of the variability in the GINI coefficient is explained by the model. This is low, which can suggest that the model dosen't explain the variation in gini.

    -   Adjusted R-squared is even lower (0.05474), is therefore expected that the model dosen't really explain the variance in the dependent variable (gini).

-   Model significance:

    -   The F-statistic (3.142) indicate the significance of the regression model. We can see here, that with the p-value of 0.08474, the model isn't significant at a 5% level.

By looking at these numbers, we can see that the model may not reliably predict the gini coefficient. It also suggest that GDP per capita may not be a valid predictor of the gini coefficient.

We also examined our selected countries seperately in order to see how the reliability and validity of the model might vary between countries. However, since there are too few observations for most of the countries, it makes it hard to make a conclusion of the reliability. What we can see from this examination, is that the models for Denmark, Portugal and Slovakia are not statistically significant. France seem however to have significant coefficiants, and Hungary have a moderate R-squared (but lacks significance in the slope).

**Ordinary Least Squares (OLS) Estimation**

"The OLS method is employed to identify the best-fitting linear relationship between the dependent and independent variables, aiming to minimize the sum of squared residuals. This technique ensures that the estimations of the intercept (β0) and slope (β1) yield the least possible cumulative discrepancy between the actual and predicted values. The strength of OLS lies in its closed-form solution, providing a straightforward computation of coefficients directly from the data-set, without necessitating iterative procedures.

Furthermore, when the classical linear regression assumptions are met, OLS guarantees that the estimators are BLUE, ensuring their unbiasedness and efficiency. This is particularly crucial in econometric analysis, where the precision and reliability of parameter estimates are paramount for policy implications and economic interpretations. The foundation assumptions of linear regression, including linearity, independence, homoscedasticity, and normality of residuals, are prerequisites for OLS to attain these desirable properties. It is imperative, therefore, to conduct diagnostic tests and assess the validity of these assumptions to ensure the robustness of the OLS estimators used in our analysis."

### **Assumptions**

**I. Linearity**

The relationship between the independent variable X and the dependent variable Y is linear. This means that changes in X are associated with proportional changes in Y. A straight line should provide a good fit to the data points when plotted on a graph.

You can create a scatter plot of Y versus X and visually inspect whether a straight line could well represent the relationship. Alternatively, you can plot the residuals versus the fitted values and check for any obvious patterns or non-linearity.

**II. Independence:**

Observations are independent of each other. The value of Y for one observation should not depend on the value of Y for any other observation.

This assumption is more about study design and data collection. Ensure that your observations are not correlated in time or space. For example, if you're analyzing economic data across regions, make sure that the regions are not influencing each other.

**III. Homoscedasticity (Equal Variance):**

The variance of the residuals (the errors) is constant across all levels of X. This means that the spread or "width" of the residuals should remain roughly the same across all values of the independent variable.

A plot of residuals versus fitted values should show a random scatter and not display any funnel-like shapes (wider at one end).

**IV. Normality of Residuals:**

The residuals (the differences between observed and predicted values) are normally distributed. This assumption is particularly important for hypothesis testing and creating confidence intervals.

A Quantile-Quantile (Q-Q) plot of the residuals can show if they follow a normal distribution. The points should fall roughly along a straight line.

**V. No Perfect Multicollinearity (Specific to Multiple Regression)**

In multiple regression settings, this assumes that no independent variable is a perfect linear function of any other independent variables. While this is more pertinent to multiple linear regression, it is crucial there because high correlation between independent variables can lead to unstable coefficient estimates.

Checking the variance inflation factor (VIF) for each variable; a VIF above 5-10 indicates a problematic amount of collinearity.

**Visualization**

```{r}
#| echo: false

# Making two plots, first one is a residuals vs fitted plot, while the other is a normal Q-Q residuals plot
plot(lm, which = 1:2) 
```

We've made two plots that can help us understand the relationship between GDP per capita and the Gini coefficient, and that together with the regression statistics can help with discussing if the classical OLS assumptions hold for the model. The first one is a plot that shows us residuals vs fitted values, which can help us check the homoscedasticity assumption of a linear regression model. The residuals should be randomly scattered around the horisontal 0 line, something that can inducate that the variances of the error terms are constant. In our plot, the residuals are in some extent randomly distributed, and there is also no clear pattern; this suggest that there is likely no significant issues with heteroscedasticity or non-linearity.

The other plot - normal Q-Q plot - is used to assess if the residuals of the linear model are normally distributed. In our plot, most of the points follow the line closely, suggesting that the residuals are normally distributed. There are however some outliers in the tails, that suggest some variation from normality.

In both of these plots, we can see that there are some outliers, these can affect the fit of the model. These outliers might come from regions that have a high GDP per capita compared to rest of the regions, like Paris in France that is a financial hub.

```{r}
#| echo: false
#| label: fig_scatterplot-all
#| cap-location: bottom
#| fig-cap: "Relationship Between GDP per Capita and Gini"

# Visualization of the relationship between GDP per capita and gini
ggplot(data2010, aes(x = log_GDP_per_capita, y = gini_n2)) +
  geom_point(aes(color = log_GDP_per_capita), size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(
    title = "Relationship Between GDP per Capita and Gini",
    x = "GDP per capita",
    y = "Gini",
    caption = "Red line indicates the fitted regression line"
  ) +
  theme_minimal()
```

In this plot we are visualizing the relationship between GDP per capita and gini by using a mix of the two previous plots. We can here as well, see extreme outliers.

## Part 2B: Exploring Other Determinants of Inequity

### I. Data Acquisition

Se data section for more specifications on the added population nut2, transport infrastructure and education.

In order to conduct a Multiple Linear Regression model, we need to have some independent variables to use in the model and compare them with the dependent variable. The first variable, education, can explain income inequality, since it can influence income distribution in a region. If access to education is unequal, then higher education levels might incease income disparities [@rodriguez-pose2008]. The population density, our second variable, can explain inequality since regions with a higher population density might have different economic behaviours. Our last variable, rail network (infrastructure), can influence economic development and accessibility, which also can affect income inequality in a region [@chatterjee2012].

```{r}
#| echo: false
#| output: false
#| label: data acquistion

# Importing datasets

# Data for population density
demo_dens <- read_csv("Raw_data/demo_dens.gz")

# Data for education
educ_data <- read_csv("Raw_data/educ.gz")

# Data for rail network
rail_data <- read_csv("Raw_data/rail.gz")


# Renaming and tidying up the new dataframes 
demo_dens <- demo_dens %>%
  rename(year = TIME_PERIOD, id_nuts2 = geo, pop_density = OBS_VALUE)

educ_data <- educ_data %>%
  rename(year = TIME_PERIOD, id_nuts2 = geo, students_percentage = OBS_VALUE)

rail_data <- rail_data %>%
  rename(year = TIME_PERIOD, id_nuts2 = geo, rail_km = OBS_VALUE)
```

```{r}
#| echo: false
#| output: false

# The NUTS 2 regions in France changed names in 2018. The dataset with education use the old codes while the other datasets use the new codes, we therefore had to change the names in order to be able to merge them together properly. 

# Changing NUTS 2 names for France
nuts2_mapping <- c(
  FR10 = "FR10",
  FR21 = "FRF2",
  FR22 = "FR22",
  FR23 = "FRD2",
  FR24 = "FRC1",
  FR25 = "FRD2",
  FR26 = "FRF2",
  FR30 = "FR22",
  FR41 = "FRF3",
  FR42 = "FRF1",
  FR43 = "FRF3",
  FR51 = "FRG0",
  FR52 = "FRH0",
  FR53 = "FRI3",
  FR61 = "FRI3",
  FR62 = "FRJ2",
  FR63 = "FRI3",
  FR71 = "FRK2",
  FR72 = "FRK1",
  FR81 = "FRJ1",
  FR82 = "FRL0",
  FR83 = "FRM0"
  )

# Adding the new names to the dataset
educ_fixed <- educ_data |>
  mutate(id_nuts2 = recode(id_nuts2, !!!nuts2_mapping))

# Selecting only the necessary columns
demo_dens_selected <- select(demo_dens, year, id_nuts2, pop_density)
educ_selected <- select(educ_fixed, year, id_nuts2, students_percentage)
rail_selected <- select(rail_data, year, id_nuts2, rail_km)

# Merging the datasets
merged_datasets <- demo_dens_selected |>
  left_join(educ_selected, by = c("year", "id_nuts2")) |>
  left_join(rail_selected, by = c("year", "id_nuts2"))

# Filter by year 2010
merged_datasets_2010 <- merged_datasets |>
  filter(year == 2010)

# Merging with dataset containing GDP per capita and gini
Merged_datasets_gini <- merged_datasets_2010 |>
  left_join(data2010, by = c("year", "id_nuts2"))

# cleaning dataset and selecting variables
Merged_datasets_gini <- Merged_datasets_gini |>
  select(year, id_nuts2, id_nuts0, gini_n2, GDP_per_capita, log_GDP_per_capita, students_percentage, pop_density, rail_km)

# Removing NA values from gini_n2 
Merged_datasets_gini <- Merged_datasets_gini |>
  filter(!is.na(gini_n2))

# Remove nuts 2 variables that gets repetead
cleaned_data <- Merged_datasets_gini |>
  distinct(id_nuts2, .keep_all = TRUE)
```

### II. Multiple Linear Regression Model

Multiple Linear Regression (MLR) extends simple linear regression to incorporate multiple explanatory variables, allowing us to examine how multiple factors impact a dependent variable. Choosing a data set from the year 2010 that consists of various regions, with data on each region's economic indicators, demographic variables, and other factors. Our aim is to understand how these variables collectively affect regional inequality.

We will in this part do a Multiple Linear Regression model by using the variables education (in percentage of pupils and students in education, % of total population), population density and rail network in km. This model will tell us if these variables can help explain change in the gini coefficient.

In both our simple linear regression model, and now in our multiple linear regression model, we use the logarithmic function which makes it easier to linearize the relationship between the variables. By using it for GDP per capita, we can reflect changes more effectively. For rail network and population density, the logarithm function ensure that the model capture proportional changes and deals better with the wide range of values.

```{r}
#| echo: false
#| fig-cap: Multiple Linear Regression Model

# Estimations with the help of several independent variables

# To begin with, we'll look at how education can explain the gini coefficient
lm1 <- lm(gini_n2 ~ log_GDP_per_capita + students_percentage, subset(cleaned_data))

# Here we look at how both population density and education can explain the gini coefficient 

lmdens1 <- lm(gini_n2 ~ log_GDP_per_capita + students_percentage + log(pop_density), subset(cleaned_data))

# Lastly, we look at how all of our selected variables, rail, education and population density, can explain the gini coefficient

lm2 <- lm(gini_n2 ~ log_GDP_per_capita + students_percentage + log(pop_density) + log(rail_km), subset(cleaned_data))

# Regression statistics
huxreg("Model" = lm1, 
       "Model 2" = lmdens1, 
       "Model 3" = lm2, 
       statistics = c("r.squared","adj.r.squared", "statistic", "p.value"))
```

### Model specification

**Understanding the Coefficients**

Intercept beta_0 Represents the expected value of the dependent variable when all independent variables are set to zero. Interpretation is often nonsensical in multiple regression if there is no meaningful condition where all predictors are zero.

Slope Coefficients beta_1, beta_2, \..., \\beta_k \\))\*\*: Represent the expected change in the dependent variable for a one-unit change in the respective independent variable, holding all other variables constant.

### III. Model Interpretation

Our first model in the Multiple Linear Regression model examine how education in addition to GDP per capita can help explain the gini coefficient. The second model look at both education, GDP per capita, and population density, while the third model examine them all and also add rail network.

For model 1, the adjusted R-squared is 0.033, indicating that the model explains around 3% of the variability in the gini coefficient. Since this is relatively low, it suggests that model 1 is not suitable in explaining the variance in gini. Both variables have a p-value above 0.05, indicating that they are not statistically significant.

For model 2, the adjusted R-squared is 0.300, which indicate that the model explains around 30% of the variability in the gini coefficient. This is pretty high, suggesting that model 2 is suitable in explaining the variance in gini, meaning that adding population density improves the model's explanatory power. The p-value for population density is less than 0.01, which means that its statistically significant.

The adjusted R-squared for model 3 is 0.370 \~ 37%; this suggest that this model has the greatest fit of all 3 models. Population density is significant at a 0.05 level. The p-value for rail is not below 0.05, and is therefore not statistically significant.

To summarize, we can see that the population density is the variable that affects the gini coeffcient the most. The more people that live in an area, the bigger the economic inequality is.

# Assignment 3: Alternative Functional Forms and Panel Estimates

## Testing Development Effects Across Subsets

### Subset Analysis

When exploring whether the effect of development and economic inequality is significantly different between different subsets. We look at the variantions between our biggest country (France) compared to the rest of the countries.

Choosing France as a dummy variable amongst our group of countries could be justified based on several criteria. Firstly, France stands out as one of the largest economies in this group, both in terms of GDP and global economic influence. This distinction makes France a unique case compared to the smaller economies of Denmark, Portugal, Hungary, and Slovakia. Secondly, France's larger geographical area and population size provide different economic dynamics and complexities, which are not as pronounced in smaller and more homogenous countries. Thirdly, France's economy is more diversified compared to the other countries listed, which might have more specialized or less varied economic structures. This diversity can lead to different patterns in wealth distribution and economic development. Lastly, France's policies, particularly in social welfare and economic regulation, and its larger domestic market, might influence economic outcomes differently than in the smaller economies, where external trade and different policy contexts play a more significant role.

```{r}
#| echo: false

# Dummy variable
gini_filtered$France <- ifelse(gini_filtered$id_nuts0 == "FR", 1,0)
gini_filtered$Other <- ifelse(gini_filtered$id_nuts0 == "FR", 0,1)

# Regression analysis
gini_filtered <- gini_filtered
lmFR = lm(gini_n2 ~ GDP_per_capita, filter(gini_filtered, France == 1))
lmC = lm(gini_n2 ~ GDP_per_capita, filter(gini_filtered, France == 0))

huxreg(list("France" = lmFR, "All other countries" = lmC), statistics = c(N = "nobs", R2 = "r.squared", FStat = "statistic", PValue = "p.value"), note = "Note: {stars} T statistics in brackets.")
```

### Subset Analysis Discussion

For France, the regression model shows us a significant and positive relationship between GDP per capita and the Gini coefficient. The intercept is statistically significant, but negative. The positive coefficient of GDP per capita of 0.028 is highly significant with a p-value lower than 0.001; this suggests that when GDP per capita in France rises, then economic inequality rises correspondingly as well. We can also see this by looking at the R-squared of 0.637, indicating that around 63.7% of the variation in the economic inequality can be explained by changes in economic development (GDP per capita). To summarize our findings for France, we can see that economic growth in France can be associated with rising economic inequality, something that could possibly be due to a concentration of wealth in some regions (like Paris for example).

When comparing France to the rest of the countries, we observe a different situation. Showing the relationship between GDP per capita and Gini is not statistically significant. This model has a positive, but non-significant coefficient for GDP per capita, which can suggest that variations in this variable does not have a significant impact on economic inequality. This is also shown by looking at the low R-squared of 0.004 \~ 0.4%, this may mean that GDP per capita only explains a rather small portion of the variance in inequality.

Overall we record major differences between France and the other countries when it comes to the relationship between economic development and economic inequality.

## Exploring Alternative Functional Forms

### Functional Form Exploration

In addition to the linear model, other models such as logarithmic transformation, the quadratic term and the cubic are useful to explain the relationship between regional development and economic inequality . By using these additional models, we can test different transformations of the variables in order to find the best representation of the data. The addditional models are explained in more details below.

**Logarithmic transformation**

The logarithmic transformation for all the variables allows the coefficients to be interpreted as elasticizes, which measure the percentage change in the dependent variable associated with a one percent change in the independent variable [@lessmann2017]. The use of logarithmic transformations is a common practice in econometrics to address issues such as heteroscedasticity and non-linearity in the data. By using logarithmic transformations, we are able to estimate the relationship between regional inequality and development in a more robust and accurate way [@lessmann2017].

**The quadratic term**

The quadratic term in the regression model is used to investigate the relationship between regional inequality and development. The results suggest an inverted U-shaped relationship between income and inequality, as indicated by a negative coefficient for the quadratic term [@lessmann2017]. This implies that initially, as income rises, inequality increases, but after reaching a certain threshold, further increases in income lead to a decrease in inequality [@lessmann2017].

**The cubic function**

The cubic function allows for the exploration of an N-shaped relationship between two variables. As suggested by @lessmann2017, this can be particularly relevant when studying the link between regional inequality and development. In such a scenario, inequality might initially decrease with development, then increase, and eventually decrease again at very high levels of development.

Including a cubic term in a regression model enables the analysis of intricate dynamics, such as changing marginal effects. This is crucial in understanding how the impact of a predictor variable on the outcome variable varies at different levels of that predictor.

### Estimation and Visualization

```{r}
#| echo: false

# Comparing the different models with the linear model

# Linear model
linear_modelFR <- lm((gini_n2 ~ GDP_per_capita), filter(gini_filtered, France == 1))
linear_modelC <- lm((gini_n2 ~ GDP_per_capita), filter(gini_filtered, France == 0))

# Logarithmic model
log_modelFR <- lm(gini_n2 ~ log(GDP_per_capita), filter(gini_filtered, France == 1))
log_modelC <- lm(gini_n2 ~ log(GDP_per_capita), filter(gini_filtered, France == 0))

# Quadratic model
quadratic_modelFR <- lm(gini_n2 ~ log(GDP_per_capita) + I(GDP_per_capita^2), filter(gini_filtered, France == 1))
quadratic_modelC <- lm(gini_n2 ~ log(GDP_per_capita) + I(GDP_per_capita^2), filter(gini_filtered, France == 0))

huxreg(list("LinearFR" = linear_modelFR, "LinearC" = linear_modelC, "LogFR" = log_modelFR, "LogC" = log_modelC, "QuadraticFR" = quadratic_modelFR, "QuadraticC" = quadratic_modelC), statistics = c(N = "nobs", R2 = "r.squared", FStat = "statistic", PValue = "p.value"), note = "Note: {stars} T statistics in brackets.")
```

As earlier predicted there is a significant positive correlation between GDP per capita and Gini for France, while its non-significant for the rest of the countries. In the logarithmic model, R-squared of 0.490 in the French data set demonstrate this. Showing that the model does not explain much of the variance in the dependent variable. Other variables not included in the model might have a significant impact. While the model may still be statistically significant, the low R-squared value suggests that its predictive power is limited. However, the other countries still does not show a significant relationship, with results showing R-squared at zero. Indicates that the independent variables provide very little information about the variation in the dependent variable. This suggests that the model is not a good predictor of the dependent variable. It might be necessary to re-evaluate the model, consider additional variables, or review the underlying assumptions.

For the quadratic model, France show positive coefficient for squared term of GDP per capita, something that can suggest a U-shaped relationship between the variables. The R-squared for France is 0.682, higher than the R-squared for the other models. This implies that the model explains a moderate amount of the variance in the dependent variable. It is a resanoble fit and such values are common in social sciences and economics where the behavior or phenomena being modeled are influenced by many unobserved factors.

The other countries also indicates a U-shaped relationship, despite R-squared levels as low as 0.061 in other words only about 6.1% of the variation in the dependent variable is explained by the independent variable(s) in our model. This indicates a low level of explanatory power. Overall, the quadratic model is a better fit than the other models to explain the variance in income inequality.

#### Logarithmic Model

```{r}
#| echo: false

# Visaulization of Logarithmic model for France

france_data <- gini_filtered[gini_filtered$id_nuts0 == "FR", ]

france_data$predicted_gini_FR = predict(log_modelFR, newdata = france_data)

ggplot(france_data, aes(x = log(GDP_per_capita), y = gini_n2)) + 
  geom_point(aes(color = "Actual"), alpha = 0.5) + 
  geom_line(aes(y = predicted_gini_FR, color = "Predicted")) +
  labs(title = "Logarithmic Model for France: Predicted vs Actual Gini Coefficients",
       x = "Log of GDP per Capita",
       y = "Gini Coefficient",
       color = "Legend") +
  theme_minimal()
```

Even with a logarithmic model, extreme outliers such as those spotted above, at the end of the line can indicate that the relationship captured by the model does not hold as well in these atypical circumstances. It suggests that the economic dynamics of these extremely wealthy regions differ significantly from the average. It's important to carefully assess how these outliers influence our model and consider additional or alternative approaches to capture the complex nature of the relationship between GDP per capita and the Gini coefficient accurately.

```{r}
#| echo: false

# Visaulization of Logarithmic model for the other countries

other_countries_data <- gini_filtered[gini_filtered$id_nuts0 != "FR", ]

other_countries_data$predicted_gini_C <- predict(log_modelC, newdata = other_countries_data)

ggplot(other_countries_data, aes(x = log(GDP_per_capita), y = gini_n2)) + 
  geom_point(aes(color = "Actual"), alpha = 0.5) + 
  geom_line(aes(y = predicted_gini_C, color = "Predicted")) +
  labs(title = "Logarithmic Model for Other Countries: Predicted vs Actual Gini Coefficients",
       x = "Log of GDP per Capita",
       y = "Gini Coefficient",
       color = "Legend") +
  theme_minimal()
```

In the plot for France, we can see an upward trend, which indicated that as the log of GDP per capita increases, the gini coefficient also increases, something that suggests higher income inequality. The data points are scattered around the predicted regression line, which goes upward. This pattern also supports the regression model that shows a significant positive realtionship between the variables. There are some extreme outliers, suggesting some regions have a higher amount of economic activity (like Paris that is a economic center in France). This also shows that economic growth may lead to increased inequality because of the concentration of wealth in some regions.

The model for the other countries show that there is not a significant relationship between the variables. The data points also dosen't cluster around the predicted line, which shows that the log of GDP does not explain the variance in the Gini coefficient.

When analyzing both plots, it's clear that the relationship between economic development and income inequality behaves differently across these regions. The plot for France suggests that economic growth is associated with rising inequality, while the plot for the other countries indicates that economic growth has little to no effect on inequality

#### Quadratic Model

```{r}
#| echo: false

# Quadratic model for France

france_data$predicted_gini_FR = predict(quadratic_modelFR, newdata = france_data)

ggplot(france_data, aes(x = log(GDP_per_capita), y = gini_n2)) + 
  geom_point(aes(color = "Actual"), alpha = 0.5) + 
  geom_line(aes(y = predicted_gini_FR, color = "Predicted")) +
  labs(title = "Quadratic Model for France: Predicted vs Actual Gini Coefficients",
       x = "Log of GDP per Capita",
       y = "Gini Coefficient",
       color = "Legend") +
  theme_minimal()
```

```{r}
#| echo: false

# Quadratic model for the other countries

other_countries_data$predicted_gini_C <- predict(quadratic_modelC, newdata = other_countries_data)

ggplot(other_countries_data, aes(x = log(GDP_per_capita), y = gini_n2)) + 
  geom_point(aes(color = "Actual"), alpha = 0.5) + 
  geom_line(aes(y = predicted_gini_C, color = "Predicted")) +
  labs(title = "Quadratic Model for Other Countries: Predicted vs Actual Gini Coefficients",
       x = "Log of GDP per Capita",
       y = "Gini Coefficient",
       color = "Legend") +
  theme_minimal()
```

For France, the Gini coefficients are initially concentrated at lower levels of GDP per capita, presenting stability or a slight decrease in inequality, which then transitions into a sharp upward trend at higher GDP levels. This is indicative of an inverted U-shaped curve, a characteristic of the Kuznets curve hypothesis, suggesting that inequality escalates significantly with further economic growth [@ota2017]. The quadratic model appears to fit the lower and middle range of the data well, yet it deviates from the actual data points at the higher end of GDP per capita, signaling that other factors may come into play as the economy grows.

The quadratic model for the other countries shows a more subtle U-shaped relationship, with the initial part of the curve being relatively flat. This indicates that changes in GDP per capita have a limited effect on income inequality at first. However, a steep increase is observed at the higher end of GDP per capita, which may be attributed to outliers or specific country conditions not captured by the model.

Incorporating these observations, both plots still signify a non-linear relationship between GDP per capita and income inequality, but with varying patterns and intensities between France and the other countries. The pronounced curve for France supports a stronger Kuznets curve effect, while for the other countries, the effect is less pronounced and the connection between economic growth and inequality appears to be weaker and more influenced by external or unmodeled factors.

### Results Interpretation

The linear model, while providing a significant fit for France, falls short for the other countries, suggesting that the economic inequality's relationship to GDP per capita may not be linear or might be influenced by factors not captured in a simple linear model. The logarithmic model's reduced explanatory power compared to the linear model for France suggests that the relationship between GDP and inequality may not be strictly proportional across all levels of GDP per capita.

The quadratic model's U-shaped curve implies that as countries develop, inequality may first decrease and then increase, supporting the Kuznets curve hypothesis.

In conclusion, while the linear model provides a baseline understanding of the relationship between GDP per capita and income inequality, the logarithmic and quadratic models offer more nuanced insights that can lead to a deeper understanding of the underlying economic mechanisms. These alternative models highlight the importance of considering non-linear dynamics when analyzing economic relationships.

## Heteroskedasticity Testing and Causality Discussion

### Heteroskedasticity Testing

Heteroskedasticity is according to @wooldridge2020 an important factor to consider in econometrics and statistical modelling, especially in the context of regression analysis. Heteroskedasticity refers to the condition in regression analysis where the variance of the error terms (residuals) is not constant across all levels of the independent variables \[@wooldridge2020\]. In simpler terms, the spread of the residuals varies at different points in the regression model. Moreover, heteroskedasticity can lead to inefficient estimators and unreliable hypothesis tests. Leading to the assumption of homoscedastic in MRL not being met. In other words the variance of the error terms is not constant across all levels if the independent variables when heteroskedasticity is present.

By conducting a Breusch-Pagan we can detect heteroskedasticity in our regression model. The test works by checking if the variances of the errors from the regression are dependent on the values of the independent variables. A higher BP value indicates a stronger presence of heteroskedasticity. Degrees of Freedom refers to the number of independent variables in the model. P-value determines the significance of the test result. A low p-value (typically less than 0.05) suggests that the null hypothesis of homoskedasticity (constant variance of errors) can be rejected, indicating heteroskedasticity. If heteroskedasticity is detected, the standard errors of the regression coefficients may be biased, which can lead to incorrect inferences in hypothesis testing.

```{r}
#| echo: false
#| output: false

# Breusch-Pagan test for the original linear model
bptest_linearFR <- bptest(linear_modelFR)
bptest_linearC <- bptest(linear_modelC)

# Breusch-Pagan test for the logarithmic model
bptest_logFR <- bptest(log_modelFR)
bptest_logC <- bptest(log_modelC)

# Breusch-Pagan test for the quadratic model
bptest_quadFR <- bptest(quadratic_modelFR)
bptest_quadC <- bptest(quadratic_modelC)

# Output of test results
print(bptest_linearFR)
print(bptest_linearC)
print(bptest_logFR)
print(bptest_logC)
print(bptest_quadFR)
print(bptest_quadC)
```

In the case of the France, the BP value is 0.25123 with 1 degree of freedom, and a p-value of 0.6162, suggesting no significant evidence of heteroskedasticity, as the p-value is well above the typical threshold of 0.05. However, for the rest of the countries, the BP value is much higher at 83.806, with 1 degree of freedom, and the p-value is less than 2.2e-16, indicating a strong presence of heteroskedasticity. This is also the case for the log model for France and for the rest of the countries. The log model for France has a BP value of 22.971 and a p-value of 1.645e-06, while the log model for the rest shows a BP value of 60.814 and a p-value of 6.273e-15. Both indicate significant heteroskedasticity. The quadratic models exhibit similar trends. The quadratic model for France shows a BP value of 59.658 with 2 degrees of freedom and a p-value of 1.11e-13, which clearly indicates heteroskedasticity. Similarly, the quadratic model for the rest, with a BP value of 18.4, 2 degrees of freedom, and a p-value of 0.0001011, suggests notable heteroskedasticity.

Overall, these results, particularly the low p-values in most models, suggest that the null hypothesis of homoskedasticity (constant variance of errors) can be rejected, revealing heteroskedasticity. It is essential to correct for heteroskedasticity to ensure the reliability of the regression analysis. There are several methods to deal with heteroskedasticity, depending on the nature of the data and the specific requirements of the analysis. Residuals vs. Fitted is another way of detecting heteroskedasticity. However, it provides a deeper understanding of the heteroskedasticity's nature and extent

**Residuals vs. Fitted**

The residuals versus fitted values plot is another diagnostic tool that helps in visually identifying issues in a regression model, aiding in improving model accuracy and reliability [@wooldridge2020]. Even after confirming heteroskedasticity. According to @wooldridge2020 It provides a deeper understanding of the heteroskedasticity's nature and extent, which is crucial for effectively addressing it in our regression analysis. Furthermore, the interpretation of different patterns in the plot, like random dispersion indicating a good model fit or systematic patterns indicating issues. Subsiquently, ensuring robust and reliable modeling visual diagnostics, complement statistical tests \[@wooldridge2020\].

```{r}
#| echo: false

# Residuals vs fitted values for linear model, all countries combined (including France)

lm_01 <- lm(gini_n2 ~ GDP_per_capita, data = gini_filtered)

# Obtaining fitted values and residuals from the model
fitted_values <- fitted(lm_01)
residuals <- resid(lm_01)

plot(fitted_values, residuals, 
     xlab = "Fitted Values", 
     ylab = "Residuals", 
     main = "Residuals vs Fitted Values for Linear Model",
     pch = 20)
abline(h = 0, col = "blue", lwd = 2)
```

There appears to be a pattern in the residuals; they are not randomly dispersed around the horizontal line but show a curve-like trajectory as the fitted values increase. This pattern suggests non-random error variance, which is indicative of non-linearity in the relationship between the independent and dependent variables, or it could also suggest heteroskedasticity. Ideally, if the model was a perfect fit, the residuals would be randomly scattered around the zero line (the horizontal blue line in your plot) without any discernible pattern. This would indicate homoskedasticity and a good linear fit. The pattern we are seeing in our residuals plot suggests that our linear model may not be the best representation of the relationship between the variables. It could be that a non-linear model would provide a better fit or that there are other variables or transformations that should be considered. Understanding this plot is important because it directly relates to the assumptions underlying linear regression.

The observed patterns and their possible implications, suggests that our model might be missing a nonlinear relationship between the dependent and independent variables. This is a sign of model misspecification, confirming that the current linear model may not be the best fit for our data. The variance in the residuals first increasing, then decreasing, and increasing again, implies that the error terms have non-constant variance, which is a sign of heteroskedasticity.

### Causality Discussion:

The statistical relationship between two variables does not imply that one causes the other. Correlation can be due to a causative relationship or due to both variables being influenced by a third factor. Establishing causation means demonstrating that changes in one variable directly result in changes in another. To claim causality, econometricians typically need to demonstrate three things. Firstly, temporal Precedence meaning the cause must precede the effect in time. Secondly, covariation of the Cause and Effect. When the cause happens, the effect happens; when the cause doesn't happen, the effect doesn't happen. Lastly, no Plausible Alternative Explanations meaning there should be no other factors that can explain the relationship between the cause and effect.

## Panel Estimates

Since panel data has a two-dimensional structure, with observations on multiple entities across several time periods. It enables us a more detailed and complex analyses compared to purely cross-sectional or time-series data. The data will then allow us to examine both cross-sectional (differences between subjects at a point in time) and longitudinal (changes within subjects over time) effects. For instance, this approach would be apt for studying how policy changes within a region affect its GDP and inequality levels. Fixed-Effects and Random-Effects Models in panel data analysis help in controlling for unobserved heterogeneity, thereby providing a clearer picture of whether there's a causal relationship.

**Fixed effect models**

Panel data estimation is a method used in econometrics to analyse data that involves observations over multiple time periods. In the context of panel data estimation specifics of fixed-effects and random effect are used. [@lessmann2017] argues that the fixed-effects model is a reasonable approach when the differences between countries (or regions) can be viewed as parametric shifts of the regression function. However, the random-effects model allows for time-invariant unobserved heterogeneity across regions and is more appropriate when the fixed-effects model is too restrictive [@lessmann2017].

**Random-Effects Models**

@lessmann2017 mention the use of a random-effects model to investigate the determinants of within-country changes in inequality. The random-effects model controls for several country-level fixed factors (national income, number of regions, and area) and fixed effects for various country groups [@lessmann2017]. The advantage of the random-effects model is that the expected value of the country-specific effect is zero, which means that there is no need to apply any arbitrary data imputation procedure for the missing intercepts [@lessmann2017]. However, this approach may come at the cost of founding the predictions on a slightly biased coefficient [@lessmann2017]. @lessmann2017 also notes that the major coefficient of interest is not sensitive to applying either a fixed-effects model or a random-effects model with additional country and region information.

### Panel Estimation Task:

```{r}
#| echo: false
#| output: false

# Panel estiamtion

plm1 <- plm(gini_n2 ~ GDP_per_capita + log(GDP_per_capita), data = gini_filtered, index = c("id_nuts0"), model = "within",effect = "twoway") |> 
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm2 <- plm(gini_n2 ~ GDP_per_capita + log(GDP_per_capita), data = gini_filtered, index = c("year"), model = "within",effect = "twoway") |> 
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm3 <- plm(gini_n2 ~ GDP_per_capita + log(GDP_per_capita), data = gini_filtered, index = c("id_nuts2"), model = "within",effect = "twoway") |> 
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm4 <- plm(gini_n2 ~ GDP_per_capita + log(GDP_per_capita), data = gini_filtered, index = c("year","id_nuts2"), model = "within",effect = "twoway") |> 
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

huxreg(plm1, plm2, plm3, plm4, statistics = c("nobs","r.squared","adj.r.squared", "statistic", "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

### Panel Estimation Analysis

### Panel Estimation Discussion

# References

# Appendix

```{r summary-stats-appendix, echo=FALSE}
# Descriptive statistics GDP per capita, mean, min, max, SD

## Summary Statistics
# Print the summary statistics for Portugal

cat("Summary Statistics for Portugal's GDP Per Capita:\n")
print(summary_stats_portugal)

# Print the summary statistics for France
cat("\nSummary Statistics for France's GDP Per Capita:\n")
print(summary_stats_france)

# Print the summary statistics for Hungary
cat("\nSummary Statistics for Hungary's GDP Per Capita:\n")
print(summary_stats_hungary)

# Print the summary statistics for Slovakia
cat("\nSummary Statistics for Slovakia's GDP Per Capita:\n")
print(summary_stats_slovakia)

# Print the summary statistics for Denmark
cat("\nSummary Statistics for Slovakia's GDP Per Capita:\n")
print(summary_stats_denmark)
```
